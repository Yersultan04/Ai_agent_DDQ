{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/yersultanakhmer/Desktop/AIHackathon/ddq-copilot/src/lib/db/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as { prisma?: PrismaClient };\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: [\"error\", \"warn\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAEjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAO;AACxB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/yersultanakhmer/Desktop/AIHackathon/ddq-copilot/src/app/api/questions/%5BquestionId%5D/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/db/prisma\";\n\nexport async function GET(\n  _req: Request,\n  ctx: { params: Promise<{ questionId: string }> }\n) {\n  const { questionId } = await ctx.params;\n\n  const question = await prisma.question.findUnique({\n    where: { id: questionId },\n    select: {\n      id: true,\n      projectId: true,\n      externalId: true,\n      number: true,\n      section: true,\n      text: true,\n      answerType: true,\n      status: true,\n      owner: true,\n      confidence: true,\n      updatedAt: true,\n      answers: {\n        orderBy: { updatedAt: \"desc\" },\n        take: 1,\n        select: {\n          id: true,\n          text: true,\n          status: true,\n          createdBy: true,\n          updatedAt: true,\n          citations: {\n            select: {\n              id: true,\n              snippet: true,\n              relevanceScore: true,\n              chunk: {\n                select: {\n                  id: true,\n                  sourceRef: true,\n                  document: {\n                    select: { id: true, title: true, filename: true },\n                  },\n                },\n              },\n            },\n          },\n        },\n      },\n    },\n  });\n\n  if (!question) {\n    return NextResponse.json({ error: \"Not found\" }, { status: 404 });\n  }\n\n  const latestAnswer = question.answers[0] ?? null;\n\n  return NextResponse.json({\n    question: {\n      id: question.id,\n      projectId: question.projectId,\n      externalId: question.externalId,\n      number: question.number,\n      section: question.section,\n      text: question.text,\n      answerType: question.answerType,\n      status: question.status,\n      owner: question.owner,\n      confidence: question.confidence,\n      updatedAt: question.updatedAt.toISOString(),\n    },\n    answer: latestAnswer\n      ? {\n          id: latestAnswer.id,\n          text: latestAnswer.text,\n          status: latestAnswer.status,\n          createdBy: latestAnswer.createdBy,\n          updatedAt: latestAnswer.updatedAt.toISOString(),\n          evidence: latestAnswer.citations.map((c) => ({\n            citationId: c.id,\n            snippet: c.snippet,\n            relevanceScore: c.relevanceScore,\n            sourceRef: c.chunk.sourceRef,\n            documentId: c.chunk.document.id,\n            documentTitle: c.chunk.document.title,\n            filename: c.chunk.document.filename,\n          })),\n        }\n      : null,\n  });\n}\n\nexport async function PATCH(\n  req: Request,\n  ctx: { params: Promise<{ questionId: string }> }\n) {\n  const { questionId } = await ctx.params;\n  const body = await req.json().catch(() => null);\n\n  if (!body || typeof body !== \"object\") {\n    return NextResponse.json({ error: \"Invalid JSON\" }, { status: 400 });\n  }\n\n  // allow updating: status, owner, confidence\n  const data: any = {};\n  if (typeof body.status === \"string\") data.status = body.status;\n  if (typeof body.owner === \"string\" || body.owner === null) data.owner = body.owner;\n  if (typeof body.confidence === \"string\") data.confidence = body.confidence;\n\n  const updated = await prisma.question.update({\n    where: { id: questionId },\n    data,\n    select: { id: true, status: true, owner: true, confidence: true, updatedAt: true },\n  });\n\n  await prisma.activityLog.create({\n    data: {\n      projectId: (await prisma.question.findUnique({ where: { id: questionId }, select: { projectId: true } }))!\n        .projectId,\n      questionId,\n      actor: \"USER\",\n      message: `Question updated: ${Object.keys(data).join(\", \")}`,\n    },\n  });\n\n  return NextResponse.json({\n    id: updated.id,\n    status: updated.status,\n    owner: updated.owner,\n    confidence: updated.confidence,\n    updatedAt: updated.updatedAt.toISOString(),\n  });\n}\n"],"names":[],"mappings":"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"}}]
}